
\input{preamble.tex}

\begin{document}

    \maketitle

    \begin{frame}{Plan}
        \tableofcontents%[hideallsubsections]
    \end{frame}

    \section{Le jeu du Sokoban}
        \begin{frame}{Le jeu du Sokoban}
            \begin{columns}
                \begin{column}{0.3\textwidth}
                    \begin{figure}
                        \centering
                        \includegraphics[width=\columnwidth]{creator.jpg}
                        \caption*{Hiroyuki Imabayashi}
                    \end{figure}
                \end{column}
                \begin{column}{0.7\textwidth}
                    \begin{figure}
                        \centering
                        \includegraphics[width=\columnwidth]{level_example.png}
                        \caption*{\textit{XSokoban}}
                    \end{figure}
                \end{column}
            \end{columns}
        \end{frame}

        \begin{frame}{But du jeu}
            \centering
            \resizebox{\textwidth}{!}{%
                \begin{tikzpicture}
                    \node (start) {\includegraphics[width=0.5\textwidth]{rules/game_start.png}};
                    \node (end) [right=of start]{\includegraphics[width=0.5\textwidth]{rules/game_end.png}};
                    \draw[->, line width=\arrowwidth] (start.north east) to[out=60,in=130] node (label) [anchor=south, midway] {Déplacements} (end.north west);
                \end{tikzpicture}
            }
        \end{frame}

        \begin{frame}{Règles}
            \begin{columns}\usetikzlibrary{shadows,shapes,positioning}
                \begin{column}{0.5\textwidth}
                    \only<1-2>{
                        \begin{figure}
                            \centering
                            \includegraphics[width=0.9\textwidth]{rules/moves.png}
                            \caption*{Déplacements autorisés}
                        \end{figure}
                    }
                    \only<3>{
                        \begin{figure}
                            \centering
                            \includegraphics[width=0.9\textwidth]{rules/move_no_1.png}
                            \caption*{\includegraphics[width=\iconwidth]{icons/no.png}}
                        \end{figure}
                    }
                \end{column}
                \begin{column}{0.5\textwidth}
                    \only<2>{
                        \begin{figure}
                            \centering
                            \includegraphics[width=0.9\textwidth]{rules/move_yes.png}
                            \caption*{\includegraphics[width=\iconwidth]{icons/yes.png}}
                        \end{figure}
                    }
                    \only<3>{
                        \begin{figure}
                            \centering
                            \includegraphics[width=0.9\textwidth]{rules/move_no_2.png}
                            \caption*{\includegraphics[width=\iconwidth]{icons/no.png}}
                        \end{figure}
                    }
                \end{column}
            \end{columns}
        \end{frame}

        \begin{frame}{Tuiles}
            \centering

            \includegraphics[width=0.5\textwidth]{tiles/tilemap.png}

            \resizebox{\textwidth}{!}{%
                \begin{tabular}{ c c c c c }
                    \includegraphics[width=0.2\textwidth]{tiles/wall.png} &
                    \includegraphics[width=0.2\textwidth]{tiles/floor.png} &
                    \includegraphics[width=0.2\textwidth]{tiles/crate.png} &
                    \includegraphics[width=0.2\textwidth]{tiles/target.png} &
                    \includegraphics[width=0.2\textwidth]{tiles/crate_on_target.png} \\
                   \textbf{Mur} & Sol & \textbf{Caisse} & Cible & \textbf{Caisse sur une cible} \\
                \end{tabular}
            }

            % For some reason, the minted environement is not working
            \only<2>{
                \mint{java}|enum Tile {WALL, FLOOR, CRATE, TARGET, CRATE_ON_TARGET};|
                \mint{java}|Tile[][] map = new Tile[height][width];|
            }

        \end{frame}

        \begin{frame}{Lien avec le thème de l'année}
            \centering
            \only<1>{\includegraphics[width=0.9\textwidth]{warehouse.jpg}}
            \only<2>{\includegraphics[width=0.9\textwidth]{city_plan.jpg}}
        \end{frame}

    \section{Principe de résolution}
        \begin{frame}{Arbre des états}
            \input{content/search_tree.tex}
        \end{frame}

        \begin{frame}{Calcul du \textit{hash} d'un état}
        \end{frame}

    \section{Réduction de l'espace de recherche}

        \subsection{Analyse statique}

            \begin{frame}{Détection des positions mortes \textit{(dead positions)}}
                \centering
                \only<1>{
                    \resizebox{\textwidth}{!}{%
                        \begin{tikzpicture}
                            \node(before){\includegraphics[width=0.5\textwidth]{dead_positions/example_before.png}};
                            \node(after)[right=of before]{\includegraphics[width=0.5\textwidth]{dead_positions/example_after.png}};
                            \draw[->, line width=\arrowwidth] (before) -- (after);
                        \end{tikzpicture}
                    }
                }
                \only<2-> {
                        \only<2>{
                            \resizebox{\textwidth}{!}{%
                                \begin{tikzpicture}
                                    \node(first){\includegraphics[width=0.5\textwidth]{dead_positions/algo_1_1.png}};
                                    \node(second)[right=of first]{\includegraphics[width=0.5\textwidth]{dead_positions/algo_1_2.png}};
                                    \draw[->, line width=\arrowwidth] (before) -- (after);
                                \end{tikzpicture}
                            }
                        }
                        \only<3->{
                            \resizebox{\textwidth}{!}{%
                                \begin{forest}
                                    for tree = {
                                        l sep = 15em,
                                        edge = {line width = 3mm, ->},
                                    }
                                    [{\includegraphics{dead_positions/algo_2_1.png}}, grow=east
                                        [\includegraphics{dead_positions/algo_2_2.png}, name=no,
                                         edge label={node[midway, below=8mm, font=\fontsize{60}{63.5}\selectfont]{$\dots$}}]
                                        [\includegraphics{dead_positions/algo_2_3.png}, name=yes]
                                    ]
                                    \node[right = of yes]{\includegraphics[width=3cm]{icons/yes.png}};
                                    \node[right = of no]{\includegraphics[width=3cm]{icons/no.png}};
                                \end{forest}
                            }
                        }
                }
            \end{frame}

            \begin{frame}{Détection de tunnels}
                \only<1>{
                    \includegraphics[width=\textwidth]{tunnels/tunnels.png}
                }
                \only<2>{
                     \includegraphics[width=\textwidth]{tunnels/tunnel_macro.png}
                }
                \only<3>{
                    \includegraphics[width=\textwidth]{tunnels/tunnel_macro_player_only.png}
                }
                \only<4>{
                    \includegraphics[width=\textwidth]{tunnels/tunnel_macro_oneway.png}
                }
                \only<5>{
                    \begin{minipage}{0.4\textwidth}
                         \includegraphics[width=\textwidth]{tunnels/straight.png}
                    \end{minipage}
                    \hfill
                    \begin{minipage}{0.4\textwidth}
                         \includegraphics[width=\textwidth]{tunnels/corner.png}
                    \end{minipage}
                }
            \end{frame}

            \begin{frame}{Calcul d'un ordre de rangement \textit{(packing order)}}
            \end{frame}

        \subsection{Analyse dynamique}

            \begin{frame}{Détection d'impasses \textit{(deadlocks)}}
                % Ajouter un exemple simple de deadlock ?
                \begin{figure}
                    \centering
                    \subcaptionbox{\textit{Freeze deadlock n°1}} {
                        \includegraphics[width=0.3\textwidth]{freeze_deadlock/ex_1_dead.png}
                    }
                    \subcaptionbox{\textit{Freeze deadlock n°2}} {
                        \includegraphics[width=0.3\textwidth]{freeze_deadlock/ex_2_dead.png}
                    }
                    \subcaptionbox{\textit{PI Corral deadlock}} {
                        \includegraphics[width=0.3\textwidth]{pi_corral_deadlock_dead.png}
                    }
                \end{figure}
            \end{frame}

            \begin{frame}{Détection de \textit{freeze deadlocks}}
                \begin{figure}
                    \subcaptionbox{\textit{Règle n°1}} {
                        \includegraphics[width=0.3\textwidth]{freeze_deadlock/rule_1.png}
                    }
                    \subcaptionbox{\textit{Règle n°2}} {
                        \includegraphics[width=0.3\textwidth]{freeze_deadlock/rule_2.png}
                    }
                    \subcaptionbox{\textit{Règle n°3}} {
                        \includegraphics[width=0.3\textwidth]{freeze_deadlock/rule_3.png}
                    }
                \end{figure}
            \end{frame}

            \begin{frame}{Détection de \textit{freeze deadlocks}}
                \centering
                \begin{tikzpicture}
                    \node (start) {
                        \includegraphics[width=0.4\textwidth]{freeze_deadlock/ex_2_dead.png}
                    };
                    \node[visible on=<2-4>, right=of start] (first) {
                        \includegraphics[width=0.4\textwidth]{freeze_deadlock/ex_2_explanation_1.png}
                    };
                    \node[visible on=<3-4>, below=of first] (second) {
                        \includegraphics[width=0.4\textwidth]{freeze_deadlock/ex_2_explanation_2.png}
                    };
                    \node[visible on=<4>, left=of second] (third) {
                        \includegraphics[width=0.4\textwidth]{freeze_deadlock/ex_2_explanation_3.png}
                    };
                    % don't remove '0cm', otherwise tikz will place the text too below
                    \node [visible on=<4>, below=0cm of third.south] {Gelée!};

                    \draw[->, line width=\arrowwidth, visible on=<2-4>] (start.east)  -- (first.west);
                    \draw[->, line width=\arrowwidth, visible on=<3-4>] (first.south) -- (second.north);
                    \draw[->, line width=\arrowwidth, visible on=<4>] (second.west) -- (third.east);
                \end{tikzpicture}
            \end{frame}
            \begin{frame}{Détection de \textit{PI Corral deadlocks}}

            \end{frame}
            \begin{frame}{Table de \textit{deadlocks}}
                \only<1>{
                    \centering
                    \includegraphics[width=0.6\textwidth]{deadlock_table/init.png}
                }
                \only<2>{
                    \centering
                    \includegraphics[width=0.6\textwidth]{deadlock_table/new_deadlock.png}
                }
            \end{frame}

    \section{Recherche dirigée par une heuristique}
        \begin{frame}{Heuristique simple \textit{(Simple Lower Bound)}}
            \centering
            \only<1>{\includegraphics[width=0.9\textwidth]{heuristics/example.png}}
            \only<2>{
                \includegraphics[width=0.9\textwidth]{heuristics/simple.png}
                \Large$\boxed{2 + 4 + 3 = \mathbf{9}}$
            }
        \end{frame}

        \begin{frame}{Heuristique gloutonne \textit{(Greedy Lower Bound)}}
            \centering
            \only<1>{\includegraphics[width=0.9\textwidth]{heuristics/greedy.png}}
            \only<2->{
                \begin{columns}
                    \begin{column}{0.4\textwidth}
                        \begin{center}
                            \only<2>{
                                \includegraphics[width=0.9\textwidth]{heuristics/greedy.png}
                            }
                            \only<3>{
                                \includegraphics[width=0.9\textwidth]{heuristics/greedy_end.png}
                                \Large$\boxed{2 + 3 + 5 = \mathbf{10}}$
                            }
                        \end{center}
                    \end{column}
                    \begin{column}{0.2\textwidth}
                        \begin{center}
                            \begin{tabular}{ | c | c | }
                                \hline
                                $1 \rightarrow A$ & 3 \\
                                \hline
                                $1 \rightarrow B$ & 2 \\
                                \hline
                                $1 \rightarrow C$ & 3 \\
                                \hline
                                $2 \rightarrow A$ & 4 \\
                                \hline
                                $2 \rightarrow B$ & 4 \\
                                \hline
                                $2 \rightarrow C$ & 5 \\
                                \hline
                                $3 \rightarrow A$ & 5 \\
                                \hline
                                $3 \rightarrow B$ & 4 \\
                                \hline
                                $3 \rightarrow C$ & 3 \\
                                \hline
                            \end{tabular}
                        \end{center}
                    \end{column}
                    \begin{column}{0.1\textwidth}
                        \begin{center}
                            \begin{tikzpicture}
                                \draw[->, line width=1mm, outer sep = 0, inner sep = 0] (0,0) -- node[above=2mm]{Tri} (1,0);
                            \end{tikzpicture}
                        \end{center}
                    \end{column}
                    \begin{column}{0.2\textwidth}
                        \begin{center}
                            \begin{tabular}{ | c | c | }
                                \hline
                                $\mathbf{1 \rightarrow B}$ & \textbf{2} \\
                                \hline
                                $1 \rightarrow A$ & 3 \\
                                \hline
                                $1 \rightarrow C$ & 3 \\
                                \hline
                                $\mathbf{3 \rightarrow C}$ & \textbf{3} \\
                                \hline
                                $2 \rightarrow B$ & 4 \\
                                \hline
                                $3 \rightarrow B$ & 4 \\
                                \hline
                                $2 \rightarrow A$ & 5 \\
                                \hline
                                $2 \rightarrow C$ & 5 \\
                                \hline
                                $\mathbf{3 \rightarrow A}$ & \textbf{5} \\
                                \hline
                            \end{tabular}
                        \end{center}
                    \end{column}
                \end{columns}
            }
        \end{frame}

    \section{Optimisations}
        \begin{frame}{}
        \end{frame}

    \section{Résultats}
\end{document}
